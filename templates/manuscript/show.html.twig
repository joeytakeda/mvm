{% extends 'base.html.twig' %}

{% set hasContributions =  (manuscript.manuscriptContributions | length > 0) %}
{% set hasFeatures = (manuscript.manuscriptFeatures | length > 0) %}
{% set hasContents = (manuscript.manuscriptContents | length > 0) %}


{% block title %}MVM: {{ manuscript.callNumber }} {% endblock %}


{% block breadcrumb %}
{% include 'partial/breadcrumb.html.twig' with {'index': 'manuscript', 'show': manuscript.callNumber} %}
{% endblock %}

 {% block pageheader %}
     <h1>{{ manuscript.callNumber }}</h1>
{% endblock %} 


{% block admin %}
<div class="btn-toolbar">
    <div class="btn-group pull-right">
        <a href="{{ path('manuscript_edit', { 'id': manuscript.id }) }}" class="btn btn-default">
            <span class='glyphicon glyphicon-edit'></span> Edit </a>
        <a href="{{ path('manuscript_delete', { 'id': manuscript.id }) }}" class="btn btn-default" data-confirm="Are you sure you want to delete this Manuscript?">
            <span class='glyphicon glyphicon-remove'></span> Delete </a>
  
    </div>
</div>
{% endblock %}


{% block body %}

<ul class="nav nav-pills" id="tabs" role="tablist">
    <li class="nav-item active">
        <a class="nav-link active" id="details-tab" data-toggle="tab" href="#details" role="tab" aria-controls="details" aria-selected="true">Details</a>
    </li>
    {% if hasContributions or isAdmin %}
    <li class="nav-item">
        <a class="nav-link" id="contributions-tab" data-toggle="tab" href="#contributions" role="tab" aria-controls="contributions" aria-selected="false">Contributions</a>
    </li>
    {% endif %}
    
    {% if hasContents or isAdmin %}
    <li class="nav-item">
        <a class="nav-link" id="contents-tab" data-toggle="tab" href="#contents" role="tab" aria-controls="contents" aria-selected="false">Contents</a>
    </li>
    {% endif %}
    
    {% if hasFeatures or isAdmin %}
    <li class="nav-item">
        <a class="nav-link" id="features-tab" data-toggle="tab" href="#features" role="tab" aria-controls="features" aria-selected="false">Features</a>
    </li>
    {% endif %}
    

    
</ul>
<div class="tab-content" id="tabContent">
    <div class="tab-pane active" id="details" role="tabpanel" aria-labelledby="details-tab">
        <div class="table-container">
            <table class="table">
                <tbody>
                    <tr>
                        <th>Title</th>
                        <td>{{ manuscript.title }}</td>
                    </tr>
                    <tr>
                        <th>Untitled</th>
                        <td>{% if manuscript.untitled %}Yes{% else %}No{% endif %}</td>
                    </tr>
                    <tr>
                        <th>Archive</th>
                        <td>
                            {% if manuscript.archive %}
                            <a href="{{ path('archive_show', { 'id': manuscript.archive.id}) }}">
                                {{ manuscript.archive }}
                            </a>
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <th>Call Number</th>
                        <td>{{ manuscript.callNumber }}</td>
                    </tr>
                    <tr>
                        <th>Complete</th>
                        <td>{% if manuscript.complete %}Yes{% else %}No{% endif %}</td>
                    </tr>
                    
                    <tr>
                        <th>Description</th>
                        <td>{{ manuscript.description|raw }}</td>
                    </tr>
                    <tr>
                        <th>Format</th>
                        <td>{{ manuscript.format }}</td>
                    </tr>
                    <tr>
                        <th>Book Size</th>
                        <td>{{ manuscript.size }}</td>
                    </tr>
                    <tr>
                        <th>Filled Page Count</th>
                        <td>{{ manuscript.filledPageCount }}</td>
                    </tr>
                    <tr>
                        <th>Item Count</th>
                        <td>{{ manuscript.itemCount }}</td>
                    </tr>
                    <tr>
                        <th>Poem Count</th>
                        <td>{{ manuscript.poemCount }}</td>
                    </tr>
                    <tr>
                        <th>Period</th>
                        <td>
                            {% for period in manuscript.periods %}
                            <a href="{{ path('period_show', { 'id': period.id}) }}">
                                {{ period }}
                            </a>
                            {%- if not loop.last %}, {% endif %}
                            {% endfor %}
                        </td>
                    </tr>
                    
                    <tr>
                        <th>First Line Index</th>
                        <td>{% if manuscript.firstLineIndex %}Yes{% else %}No{% endif %}</td>
                    </tr>
                    <tr>
                        <th>Digitized</th>
                        <td>{% if manuscript.digitized %}Yes{% else %}No{% endif %}</td>
                    </tr>
                    
                    <tr>
                        <th>Region</th>
                        <td>
                            {% for region in manuscript.regions %}
                            <a href="{{ path('region_show', { 'id': region.id}) }}">
                                {{ region -}}
                            </a>{% if not loop.last %}, {% endif %}
                            {% endfor %}
                        </td>
                    </tr>
                    <tr>
                        <th>Additional Genres</th>
                        <td>{% if manuscript.additionalGenres %}{{ manuscript.additionalGenres|join(', ') }}{% endif %}</td>
                    </tr>
                    <tr>
                        <th>Print Sources</th>
                        <td>
                            {% if manuscript.printSources | length > 0 %}
                            <ul class="tag-list">
                                {% for printSource in manuscript.printSources %}
                                <li class="printSource">
                                    <a href="{{ path("print_source_show", {"id":printSource.id}) }}">
                                        {{ printSource }}
                                    </a>
                                </li>
                                {% endfor %}
                            </ul>
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <th>Themes</th>
                        <td>
                            {% if manuscript.themes | length > 0 %}
                            <ul class="tag-list">
                                {% for theme in manuscript.themes %}
                                <li class="theme">
                                    <a href="{{ path("theme_show", {"id":theme.id}) }}">
                                        {{ theme }}
                                    </a>
                                </li>
                                {% endfor %}
                            </ul>
                            {% endif %}
                        </td>
                    </tr>
                    
                    <tr>
                        <th>Bibliography</th>
                        <td>{{ manuscript.bibliography|raw }}</td>
                    </tr>
                    <tr>
                        <th>Created</th>
                        <td>{% if manuscript.created %}{{ manuscript.created|date }}{% endif %}</td>
                    </tr>
                    <tr>
                        <th>Updated</th>
                        <td>{% if manuscript.updated %}{{ manuscript.updated|date }}{% endif %}</td>
                    </tr>
                </tbody>
            </table>
        </div>
        
    </div>
    {% if hasContents or isAdmin %}
    <div class="tab-pane fade" id="contents" role="tabpanel" aria-labelledby="contents-tab">
        {% if isAdmin %}
        <div class="text-right">
            <a href="{{ path('manuscript_contents', { 'id': manuscript.id }) }}" class="btn btn-default">
                <span class='glyphicon glyphicon-edit'></span> Edit Contents</a>
        </div>
        {% endif %}
        {% if hasContents %}
        <table class="table">
            <thead>
                <tr>
                    <th>First Line</th>
                    <th>Context</th>
                    <th>Print Source</th>
                </tr>
            </thead>
            <tbody>
                {% for manuscriptContent in manuscript.manuscriptContents %}
                    <tr>
                        <td> <a href="{{ path('content_show', {'id': manuscriptContent.content.id}) }}">{{ manuscriptContent.content.firstLine }}</td>
                        <td>
                            {{ manuscriptContent.context | raw }}
                        </td>
                        <td>
                            {% if manuscriptContent.printSource %}
                                <a href="{{ path('print_source_show', {'id': manuscriptContent.printSource.id}) }}">{{ manuscriptContent.printSource }}</a>
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        
        <p>No contents available.</p>
        
        {% endif %}
        
    </div>
    {% endif %}
    
    {% if hasContributions or isAdmin %}
    <div class="tab-pane fade" id="contributions" role="tabpanel" aria-labelledby="contributions-tab">
        {% if isAdmin%}
        <div class="text-right">
            <a href="{{ path('manuscript_contributions', { 'id': manuscript.id }) }}" class="btn btn-default">
                <span class='glyphicon glyphicon-edit'></span> Edit Contributions</a>
        </div>
        {% endif %}
        
        {% if hasContributions %}
        <table class="table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Role</th>
                    <th>Note</th>
                </tr>
            </thead>
            {% for manuscriptContribution in manuscript.manuscriptContributions %}
            <tr>
                <td>
                    <a href="{{ path('person_show', {'id': manuscriptContribution.person.id}) }}">{{ manuscriptContribution.person }}</a> 
                </td>
                <td>
                    <a href="{{ path('manuscript_role_show', {'id': manuscriptContribution.role.id}) }}">{{ manuscriptContribution.role }}</a>
                </td>
                <td>
                    {{ manuscriptContribution.note|raw }}
                </td>
                
            </tr>
            {% endfor %}
        </table>
        {% else %}
        <p>No contributions available.</p>
        {% endif %}
    </div>
    {% endif %}


    {% if hasFeatures or isAdmin %}
    <div class="tab-pane fade" id="features" role="tabpanel" aria-labelledby="features-tab">
        {% if isAdmin %}
        <div class="text-right">
            <a href="{{ path('manuscript_features', { 'id': manuscript.id }) }}" class="btn btn-default">
                <span class='glyphicon glyphicon-edit'></span> Edit Features</a>
        </div>
        {% endif %}
        {% if hasFeatures %}
        <table class="table">

                <thead>
                    <tr>
                        <th>Feature</th>
                        <th>Note</th>
                    </tr>
                </thead>
            <tbody>
                {% for manuscriptFeature in manuscript.getManuscriptFeatures(true) %}
                <tr>
                    <td>
                        <a href="{{ path('feature_show', {'id': manuscriptFeature.feature.id}) }}">
                            {{ manuscriptFeature.feature.label }}
                        </a>
                    </td>
                    <td>{{ manuscriptFeature.note|raw }}</td>
                </tr>
                {% endfor %}
            </tbody>
      
  

        </table>
        {% else %}
        <p>No features available.</p>
        
        {% endif %}
    </div>
    {% endif %}
</div>
  
{% endblock %}
